@* filepath: c:\Users\xkyh0\Downloads\PicklePlay.Web\Views\Competition\_MatchListing.cshtml *@
@model PicklePlay.Models.ViewModels.MatchListingViewModel
@using PicklePlay.Data
@using PicklePlay.Models
@using Microsoft.AspNetCore.Html

<style>
    /* Status Borders */
    .match-container { border: 3px solid #dee2e6; border-radius: 0.375rem; margin-bottom: 1rem; background-color: #fff; }
    .status-active { border-color: #198754; }
    .status-progressing { border-color: #ffc107; }
    .status-done { border-color: #6c757d; }
    .status-bye { border-color: #adb5bd; }
    
    .match-header { background-color: #f8f9fa; padding: 0.75rem 1.25rem; border-bottom: 1px solid #dee2e6; }
    .match-body { padding: 1.25rem; }
    .team-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
    .team-name { font-weight: 500; font-size: 1.1rem; }
    .team-name-tbd {
        font-weight: 500;
        font-size: 1.1rem;
        color: #6c757d;
        font-style: italic;
    }
    
    /* Score Set Titles */
    .score-set-titles {
        display: flex;
        gap: 5px;
        margin-left: auto;
    }
    .score-set-title {
        width: 45px;
        text-align: center;
        font-size: 0.8rem;
        font-weight: 600;
        color: #6c757d;
    }
    
    .score-sets-container { display: flex; gap: 5px; flex-wrap: wrap; }
    .score-set-input { width: 45px; text-align: center; padding-left: 2px; padding-right: 2px; }
    .score-set-text { font-size: 1.1rem; font-weight: 500; padding: 0.25rem 0.5rem; }

    /* Winner Highlight */
    .team-winner .team-name {
        font-weight: 700;
        color: #198754;
    }
    .team-winner .team-name::after {
        content: " ✔";
    }

    /* Round Sub-Tabs Styling */
    .round-tab-pills .nav-link {
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        margin-right: 0.25rem;
        color: #495057;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        transition: all 0.2s;
    }
    .round-tab-pills .nav-link.active {
        background-color: #0d6efd;
        color: white;
        border-color: #0d6efd;
        font-weight: 600;
    }
    .round-tab-pills .nav-link:not(.active):hover {
        background-color: #e9ecef;
        color: #0d6efd;
        border-color: #0d6efd;
    }
    .round-complete-badge {
        background-color: #198754;
        color: white;
        font-size: 0.75rem;
        padding: 0.15rem 0.4rem;
        border-radius: 0.25rem;
        margin-left: 0.5rem;
    }
</style>

@if (!Model.Matches!.Any())
{
    <div class="alert alert-info mt-3">
        <i class="bi bi-info-circle me-2"></i>
        No matches available yet. Please generate matches first.
    </div>
}
else
{
    var roundGroups = Model.Matches!
        .GroupBy(m => m.RoundName)
        .OrderBy(g => g.First().RoundNumber)
        .ToList();
    
    var firstRoundName = roundGroups.First().Key;

    @* Round Sub-Tabs Navigation *@
    <ul class="nav nav-pills round-tab-pills mb-3" id="roundTabs" role="tablist">
        @foreach (var roundGroup in roundGroups)
        {
            var roundName = roundGroup.Key;
            var roundId = $"round-{roundGroup.First().RoundNumber}";
            var isFirst = roundName == firstRoundName;
            var isComplete = roundGroup.All(m => m.Status == MatchStatus.Done);
            
            <li class="nav-item" role="presentation">
                <button class="nav-link @(isFirst ? "active" : "")" 
                        id="@roundId-tab" 
                        data-bs-toggle="pill" 
                        data-bs-target="#@roundId-content" 
                        type="button" 
                        role="tab" 
                        aria-controls="@roundId-content" 
                        aria-selected="@(isFirst ? "true" : "false")">
                    @roundName
                    @if (isComplete)
                    {
                        <span class="round-complete-badge">✓</span>
                    }
                </button>
            </li>
        }
    </ul>

    @* Round Sub-Tabs Content *@
    <div class="tab-content" id="roundTabsContent">
        @foreach (var roundGroup in roundGroups)
        {
            var roundName = roundGroup.Key;
            var roundId = $"round-{roundGroup.First().RoundNumber}";
            var isFirst = roundName == firstRoundName;
            
            <div class="tab-pane fade @(isFirst ? "show active" : "")" 
                 id="@roundId-content" 
                 role="tabpanel" 
                 aria-labelledby="@roundId-tab">
                
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-trophy me-2"></i>@roundName
                        </h5>
                        <span class="badge bg-light text-dark">
                            @roundGroup.Count() @(roundGroup.Count() == 1 ? "Match" : "Matches")
                        </span>
                    </div>
                    <div class="card-body">
                        @foreach (var match in roundGroup.OrderBy(m => m.MatchNumber))
                        {
                            ViewData["IsOrganizer"] = Model.IsOrganizer;
                            <partial name="_MatchCard" model="match" />
                        }
                    </div>
                </div>
            </div>
        }
    </div>
}